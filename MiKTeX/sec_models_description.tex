\section{Описание реализованных моделей}
\label{sec:models_description}

В ходе изучения различных подходов к моделированию
видеотрафика (раздел~\ref{sse:survey}) и анализа
тестовых видеопоследовательностей (раздел~\ref{sse:traces})
было решено остановиться на двух подходах: использование
авторегерссионных и марковских моделей.

В данной работе были реализованы две конкретные модели:
модель дискретно-авторегрессионного процесса произвольного
порядка DAR(p)~\cite{heymanATM} и марковская модель на основе
марковского возобновляемого процесса~\cite{survey2013, heymanATM} (Markov Renewal Process).
В этом разделе приведено описание этих моделей, а также
описание модифицированной марковской модели, предложенной автором
в ходе дипломной работы.

\subsection{Модель DAR($p$)}
\label{sse:darp}

Дискретно-авторегрессионным случайным процессом называется
процесс, который можно описать следующим образом~\cite{survey2013}:

\begin{equation}
    S'_i = V_iS'_{i - A_i} + (1 - V_i) Y_i
    \label{eq:darp}
\end{equation}

\begin{itemize}
    \item $\{V_i\}$ -- i.i.d, распределение бернулли с вероятностью $\rho$
    \item $\{Y_i\}$ -- i.i.d с целевым распределением (выбрано отрицательное биномиальное)
    \item $\{A_i\}$ -- i.i.d с областью значений $[1\dots p]$,
        $$
        \begin{aligned}
            Pr\{A_i = k\} &= \alpha_k,\\
            \sum_{k=1}^p \alpha_k &= 1
        \end{aligned}
        $$
    \item $\{S'_i\}$ -- сгенерированная реализация процесса (интерпретируется
        как последовательность размеров кадров)
    \item $\{\alpha_k\}$ определяет автокорреляционную структуру процесса
    \item входные данные -- первые два момента распределения размеров кадров
        (для распределения $Y$) и $p$ коэффициентов автокорреляции $r(n),~n=1\dots p$
        тестовой последовательности $S$
\end{itemize}

На каждом шаге $i$ с вероятностью $1 - \rho$ генерируется новое значение с целевым
распределением $Y$, параметры которого подобраны таким образом, чтобы
соответствовать распределению размеров кадров тестовой последовательности,
или с вероятностью $\rho$ выбирается значение $p$ последних кадров предыстории
от $S'_{i-1}$ до $S'_{i-p}$. Конкретное значение индекса смещения выбирается
из вероятностного ансамбля~\cite{shannon} ($A$, $\Pi$), $A = {1 \dots p}$,
$\Pi = \{Pr\{A_i = k\} = \alpha_k\}_k$.

Отличительной особенностью дискретного авторегрессионного процесса
перед простым авторегрессионным является неизменность результирующего
распределения $S$ относительно исходного $Y$ на каждом шаге $i$, что можно доказать индукцей по $i$.
Пусть $y(k) = Pr\{Y_i = k\}$ и $s_i(k) = Pr\{S'_i = k\}$ для некоторого $k$.
$s_0 = y$, вся предыстория с отрицательными индексами генерируется
независимо при помощи распределения $Y$. Пусть для $p$ предыдущих шагов
условие $s_{j} = y$ выполняется. Тогда для шага $i$:

\begin{equation}
    \begin{aligned}
        s_i(k) &= \rho \sum_{j=1}^p \alpha_j s_j(k) + (1 - \rho)y(k) \\
               &= \rho \sum_{j=1}^p \alpha_j y(k) + (1 - \rho)y(k) \\
               &= \rho y(k) + (1 - \rho)y(k) = y(k).
    \end{aligned}
\end{equation}

Это свойство дискретного авторегрессионного процесса позволяет получить
необходимую автокорреляционную структуру, не искажая при этом
распределения.

Как уже отмечалось выше, коэффициенты $\{\alpha_i\}$ авторегрессии
подбираются на основе первых $p$ коэффициентов автокорреляции $r(n)$  таким
образом, чтобы автокорреляция процесса совпадала для первых $p$ смещений
с оценкой автокорреляции для тестовой последовательности. Нахождение
необходимых параметров авторегрессии осуществляется при помощи системы
уравнений Юла-Уокера~\cite{mixtures}.

Пусть $\overline{Y} = Y - m$ и $\overline{S}_n = S'_n - m$, $m = E(Y) = E(S'_n)$.
Рассмотрим математическое ожидание произведения $\overline{S}_n\overline{S}_{n-1}$:

\begin{equation}
    \begin{aligned}
        r(1) &= E(\overline{S}_n \overline{S}_{n-1}) \\
             &= E(\overline{S}_{n-1} V_n \overline{S}_{n - A_n}) + E(\overline{S}_{n-1} (1 - V_n) Y_n - m) \\
             &= \rho\alpha_1 r(0) + \rho\alpha_2 r(1) + \dots + \rho\alpha_p r(p - 1) \\
    \end{aligned}
\end{equation}

Проделав аналогичные манипуляции для других смещений, получаем систему уравнений
Юла-Уокера:

\begin{equation}
\left\{
\begin{aligned}
    r(1) &= \rho\alpha_1 r(0) + \rho\alpha_2 r(1) + \dots + \rho\alpha_p r(p - 1)\\
    r(2) &= \rho\alpha_1 r(1) + \rho\alpha_2 r(0) + \dots + \rho\alpha_p r(p - 2)\\
    \vdots\\
    r(p) &= \rho\alpha_1 r(p - 1) + \rho\alpha_2 r(p - 2) + \dots + \rho\alpha_p r(0)\\
    1    &= \alpha_1 + \alpha_2 + \dots + \alpha_p
\end{aligned}
\right.
\label{eq:system}
\end{equation}

В матричной форме эта система уравнений может быть записана следующим образом
(игнорируя последнее нормирующее уравнение):

\begin{equation}
        \boxed{%
        r = \rho\alpha \mathcal{R} }
\end{equation}

\begin{equation}
r = \begin{pmatrix} r(1)\\r(2)\\\vdots\\r(p) \end{pmatrix}
    \alpha = \begin{pmatrix} \alpha_1 \\ \alpha_2 \\ \vdots \\ \alpha_p \end{pmatrix}
        \mathcal{R} = \begin{pmatrix}
            r(0) & r(1) & \dots & r(p-1) \\
            r(1) & r(0) & \dots & r(p-2) \\
            \vdots & \vdots & \ddots & \vdots \\
            r(p-1) & r(p-2) & \dots & r(0) \\
        \end{pmatrix}
\end{equation}

Теплицева симметричная матрица $\mathcal{R}$ называется автокорреляционной
матрицей и может быть получена отображением матрицы индексов $$|| a_{ij} = abs(i - j) ||$$
функцией автокорреляции $r$.

Данная система уравнений имеет вид $Ax = b$, которая может быть решена методами
линейной алгебры (в том числе компьютерной) относительно $\rho\alpha$.
На основе вектора $\rho\alpha$, учитывая нормирующее уравнение в системе~\ref{eq:system},
могут быть получены коэффициенты авторегрессии $\{\alpha_k\}$ и параметр $\rho$ распределения
бернулли $V$:

\begin{equation}
    \begin{aligned}
        \rho &= \sum_j \rho\alpha_j \\
        \alpha &= \frac{\rho\alpha}{\rho}.
    \end{aligned}
\end{equation}

Ограничения на область допустимых значений вектора
$\alpha$ и скаляра $\rho$ (каждое значение должно
лежать в диапазоне $[0, 1]$) приводят к тому, что
не каждому набору первых $p$ коэффициентов автокорреляции
соответствует пара $(\rho, \alpha)$. Иными словами,
не каждой видеопоследовательности можно сопоставить
дискретную авторегрессионную модель любого порядка.

Например, для процесса DAR($2$) область допустимых
значений определяется следующим образом~\cite{mixtures}:

\begin{equation}
    1 > r(2) \geq r(1)^2.
\end{equation}

Распределение размеров кадров было решено аппроксимировать
отрицательным биномиальным распределением вслед за авторами
оригинальной статьи по использованию дискретного авторегрессионного
процесса при моделировании трафика видеоконференций~\cite{heymanATM}.
Отрицательное биномиальное распределение имеет два параметра
и обозначается $NB(q,s)$.
Пусть $\left\{ X_i \right\}_{i=1}^\infty$ --
бесконечная последовательность независимых случайных
величин с распределением Бернулли с параметром $q$.
Случайная величина $Y\approx NB(q,s)$ определяется следующим
образом. Пусть $S_n = \sum_{i=1}^n X_i$. Тогда

\begin{equation}
    Y = \inf \{ n \mid S_n = s \} - s.
\end{equation}

Иначе говоря, пусть $k + s$ -- номер $s$-го успеха в
последовательности $X$. Тогда $Y = k$. Оператор $\inf \{ A \mid B \}$ --
это инфинум, или наибольший элемент из частично упорядоченного множества
$A$, который меньше любого элемента из $B \in A$.

Первые два момента отрицательного биномиального распределения
вычисляются следующим образом:

\begin{equation}
    \begin{aligned}
        E[Y] &= \frac{s(1-q)}{q} \\
        D[Y] &= \frac{s(1-q)}{q^2} = \frac{E[Y]}{q} \\
    \end{aligned}
\end{equation}

Таким образом, получив оценки первых двух моментов распределения
размеров кадров в тестовой видеопоследовательности можно
найти параметры распределения $Y$ следующим образом:

\begin{equation}
    \begin{aligned}
        q &= \frac{E[Y]}{D[Y]} \\
        s &= \frac{qE[Y]}{1 - q}
    \end{aligned}
    \label{eq:params}
\end{equation}

Таким образом, процедура получения дискретной авторегрессионной
модели тестовой последовательности $S$ может быть сформулирована
следующим образом:

\begin{itemize}
    \item оценить дисперсию $d$ и матожидание $m$ тестовой последовательности
    \item оценить первые $p + 1$ коэффициентов автокорреляции $r$
    \item решить систему уравнений Юла-Уокера для DAR~(\ref{eq:system}),
        получить параметры авторегрессии $\alpha$ и вероятность выбора
        значения из предыстории $\rho$. Если любое из этих значений
        больше единицы или меньше нуля, отказаться от применения модели
    \item получить параметры распределения $Y$ на основе $d$ и $m$
        по формуле~(\ref{eq:params})
    \item сгенерировать необходимое количество размеров кадров
        в соответствии с определением случайного процесса DAR(p)~(\ref{eq:darp})
\end{itemize}

\newpage
\subsection{Марковская модель на основе MRP (Markov Renewal Process)}
\label{sse:marksimple}

Большая часть моделей видеотрафика, использующая марковский
случайный процесс, используют его для учёта смены сцен
или гетерогенности трафика~\cite{raey}. Однако, одна из
марковских моделей использует марковский процесс, состояниями
которого являются непосредственно размеры кадров~\cite{heymanATM}.
Эта модель была реализована и модифицирована в данной дипломной
работе. В данном подразделе описана исходная марковская модель.

Состояниями марковского процесса в данной модели являются
собственно размеры кадров. Область значений размеров кадров
исходной видеопоследовательности разбивается на $K$ равных
отрезков $\{A_i\} _{i=1}^K$.
Середина каждого отрезка принимается в качестве
аппроксимирующего значения на этом отрезке. Входная
последовательность подвергается равномерному квантованию $Q_K~:~|S|\rightarrow [1 \dots K]$
на $K$ квантов, с помощью квантованной последовательности
$\widetilde{S} = Q_K(S)$ производится оценка матрицы переходных
вероятностей $\mathcal{P}_{K\times K}$ следующим образом:

\begin{equation}
    \mathcal{P}_{ij} = \frac{N[\widetilde{S}_l = A_i,~\widetilde{S}_{l+1} = A_j,~l=1\dots N]}
                            {N[\widetilde{S}_l = A_i,~l=1\dots N]},
\end{equation}

где
\begin{itemize}
    \item $N[\widetilde{S}_l = A_i,~\widetilde{S}_{l+1} = A_j]$ -- количество переходов
        из состояния $i$ в состояние $j$, или количество следований кадра размером
        из $j$-го диапазона после кадра из $i$-го диапазона в последовательности $S$;
    \item $N[\widetilde{S}_l = A_i]$ -- количество появлений кадра из $i$-го отрезка в $S$.
\end{itemize}

Полученная на основе исходной последовательности матрица $\mathcal{P}_{K\times K}$
используется в качестве матрицы переходных вероятностей марковского процесса
$\Sigma'(S)$, работа которого осуществляется следующим образом. Пусть
на шаге $i$ состояние процесса $S'_i$, тогда:

\begin{itemize}
    \item генерируется значение $\sigma$ из дискретного ансамбля $$(1 \dots K, \{\mathcal{P}_{S'_ij}\} _{j = 1}^K).$$
        Следующее состояние выбирается с распределением вероятностей, взятых из строки матрицы $\mathcal{P}$,
        соответствующей текущему состоянию~$S'_i$.
    \item состояние $S'_{i+1} = \sigma$, процедура повторяется.
\end{itemize}

Выходом данной модели является реализация описанного случайного процесса $\Sigma'$
в стационарном режиме. Для этого можно сгенерировать первое состояние
в соответствии со стационарным распределением $\pi$ марковской цепи~\cite{markovchains},
которое может быть получено на основе матрицы переходных вероятностей
либо с помощью решения системы уравнений для стационарного распределения

\begin{equation}
    \pi = \pi \mathcal{P},
\end{equation}

либо с помощью возведения матрицы $\mathcal{P}$ в бесконечную степень:

\begin{equation}
    \pi = \mathcal{P}^\infty.
\end{equation}

Альтернативным способом получение реализации марковского процесса
в режиме стационарности является выбор произвольного состояния
в качестве исходного с последующим отбрасыванием большого количества
первых состояний реализации. Именно этот способ, в силу своей простоты,
использовался в данной работе.

Недостатками данного подхода к моделированию трафика видеоконференций
является прежде всего потребность в большом размере тестовой последовательности
для адекватной оценки матрицы переходных вероятностей и отсутствие
возможности контролировать результирующее распределение размеров
кадров.

\subsection{Модифицированная марковская модель с использованием
нелинейного квантования}
\label{sse:markkmeans}

Модель, описанную в предыдущем подразделе, было предложено модифицировать
следуюущим образом: использовать вместо равномерного квантования
неравномерное. Предположительно такое изменение позволит точнее
отражать распределение размеров кадров и получать б\`{о}льшее количество
состояний марковского случайного процесса в области концентрации
энергии исходного распределения размеров кадров. Результаты
сравнительного анализа моделей, приведённые в разделе~\ref{sec:results},
свидетельствуют о справедливости приведённых предположений.

Смысл неравномерного квантования заключается в минимизации
среднеквадратической ошибки квантования. При таком квантовании
аппроксимирующие значения должны располагаться тем плотнее
друг к другу, чем больше в данной области значение функции
плотности вероятности размеров кадров.

Как и в предыдущем случае, область значений размеров кадров
разбивается на $K$ промежутков,

\begin{equation}
    \{A_i\} _{i=1}^K = {[a_0, a_1), [a_1, a_2), \dots, [a_{K-1}, a_K]}.
\end{equation}

Зонам квантования соответствуют $K$ аппроксимирующих значений
$\{b_i \in A_i\} _{i=1}^K$. Правило квантования формулируется следующим
образом: если текущий элемент входной последовательности
лежит в промежутке $S_i \in [a_{k-1}, a_k)$, то квантованное
значение $S'_i = b_k$.

Минимизируя среднеквадратическую ошибку, получив частные
производные квадрата ошибки квантования по $b_k$ и $a_k$, получаем
условие оптимальности диапазонов квантования и аппроксимирующих
значений~\cite{digitalSignalProcessing}:

\begin{equation}
    \begin{aligned}
        b_k &= \frac{\int_{a_{k-1}}^{a_k} x p(x) dx}{\int_{a_{k-1}}^{a_k} p(x) dx} \\
        a_k &= \frac{b_{k-1} + b_k}{2},
    \end{aligned}
\end{equation}

где $p(x)$ -- функция плотности вероятности исходного сигнала,
которая может быть оценена на основе входной последовательности.

Данное условие даёт систему уравнений относительно $a_k$ и $b_k$,
решение которой может быть затруднительным, поэтому на практике
используют итеративные алгоритмы нелинейного квантования, например,
алгоритм Макса-Ллойда~\cite{lloydmax}.

В данной работе в качестве нелинейного квантователя использовался
алгоритм K-средних (англ. K-Means),
который является итеративным алгоритмом кластеризации,
рассчитаным на минимизацию квадрата расстояния (среднеквадратической ошибки)
между точками множества (входной последовательностью) и центроидами
(аппроксимирующими значениями)~\cite{kmeans}. Данный алгоритм,
формулируется в отличных от принятых в цифровой обработке
сигналов терминах, но работает почти так же, как и алгоритм
Макса-Ллойда, за некоторыми исключениями:

\begin{itemize}
    \item центроидом (аппроксимирующим значением) может быть выбрана
        только значение, изначально присутствующее в кластере.
        Таким образом, при дискретных размерах кадров проквантованная
        последовательность также будет дискретной без необходимости
        в дополнительном округлении, как это бывает необходимо при
        использовании алгоритма Макса-Ллойда;
    \item отсутствует необходимость в дополнительной процедуре оценки
        функции распределения (при целочисленных размерах кадров)
        или функции плотности вероятности. Это упрощает работу
        с методом K-средних.
\end{itemize}

\hspace{8pt}

Эти особенности метода K-средних оправдывают его использование в
качестве метода нелинейного оптимального квантования.
